console.log('UPDATED');
$("#map-container").html("<%= escape_javascript( render :partial =>  "virus_productions/components/map", :locals => {:box => @box, :box_type => @box_type, :v_max => @v_max, :h_max => @h_max, :position_ids => @position_ids, :position_names => @position_names, :position_batch_names => @position_batch_names}) %>")
$("#vb-container").html("<%= escape_javascript( render :partial => "virus_productions/components/content_inventory", :locals => {:virus_batches => @virus_batches} )%>");

var arr1 =  <%= raw @position_ids %>;
	var arr2 =  <%= raw @position_names %>;
	var arr3 = 	<%= raw @position_batch_names%>;
	
	var	vp_id= <%=@virus_production.id%>
	var vb_id=0;
	var box_id= <%=@box.id%>;
	
	console.log('arr1 length = '+arr1.length);
	console.log('arr2 length = '+arr2.length);
	console.log('arr3 length = '+arr3.length);
	console.log('box_id = '+box_id);

$('.location-label').each(function(index){
	console.log('Ajout des noms de batch des elts location-label');
	$(this).append(arr2[index]);
});

$('.location').each(function(index){
	console.log('Ajout de id des elts locations');
	$(this).attr('id',arr1[index]);
	$(this).append(arr3[index]);
});

$('.slot').each(function(index){
	console.log('Ajout du dataset des elts draggableContainer');
	$(this).attr({'data-id': arr1[index], 'data-name': arr2[index]});
})

$('.draggable').draggable({
    revert: "invalid",
    stack: ".draggable",
    start: function(event, ui){
    			console.log('Dragging start');
    			vb_id = $(this).data('id');
    			}
    });
    
$('.draggableContainer').droppable({
		drop: function(event, ui){
			console.log('Dropped');
			$(this).effect( "highlight",  {color: '#e7f5fe'}, 1000);
			console.log('data-id = '+this.dataset.id);
			console.log('data-name = '+this.dataset.name);
			//
			param = {position_id: $(this).data('id'), virus_batch_id: vb_id, box_id: box_id};
			//
			updateBox(vb_id, param);
		},
		out: function (event, ui) {
			$(this).attr('class', 'bg-default')
		}
	});
	
//Drag and Drop
function updateBox(id, param){
	$.ajax({
			url : '/virus_productions/'+vp_id+'/virus_productions/'+vb_id+'/update_box',
			type: 'patch',
			data: param,
			success: function(data){
				console.log("success")
				},
			error: function(data) { 
				console.log("error") 
			},
			})
}

//Popover
  $('[data-toggle="popover"]').popover({
  	html:true,
  	container: 'body'
  	});
